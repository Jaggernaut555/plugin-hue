parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"JJlS":[function(require,module,exports) {
"use strict";var e=Object.prototype.hasOwnProperty,t="~";function n(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,n,o,s,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var c=new r(o,s||e,i),f=t?t+n:n;return e._events[f]?e._events[f].fn?e._events[f]=[e._events[f],c]:e._events[f].push(c):(e._events[f]=c,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function i(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(t=!1)),i.prototype.eventNames=function(){var n,r,o=[];if(0===this._eventsCount)return o;for(r in n=this._events)e.call(n,r)&&o.push(t?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(n)):o},i.prototype.listeners=function(e){var n=t?t+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,i=new Array(s);o<s;o++)i[o]=r[o].fn;return i},i.prototype.listenerCount=function(e){var n=t?t+e:e,r=this._events[n];return r?r.fn?1:r.length:0},i.prototype.emit=function(e,n,r,o,s,i){var c=t?t+e:e;if(!this._events[c])return!1;var f,u,a=this._events[c],l=arguments.length;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),l){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,n),!0;case 3:return a.fn.call(a.context,n,r),!0;case 4:return a.fn.call(a.context,n,r,o),!0;case 5:return a.fn.call(a.context,n,r,o,s),!0;case 6:return a.fn.call(a.context,n,r,o,s,i),!0}for(u=1,f=new Array(l-1);u<l;u++)f[u-1]=arguments[u];a.fn.apply(a.context,f)}else{var v,h=a.length;for(u=0;u<h;u++)switch(a[u].once&&this.removeListener(e,a[u].fn,void 0,!0),l){case 1:a[u].fn.call(a[u].context);break;case 2:a[u].fn.call(a[u].context,n);break;case 3:a[u].fn.call(a[u].context,n,r);break;case 4:a[u].fn.call(a[u].context,n,r,o);break;default:if(!f)for(v=1,f=new Array(l-1);v<l;v++)f[v-1]=arguments[v];a[u].fn.apply(a[u].context,f)}}return!0},i.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},i.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},i.prototype.removeListener=function(e,n,r,o){var i=t?t+e:e;if(!this._events[i])return this;if(!n)return s(this,i),this;var c=this._events[i];if(c.fn)c.fn!==n||o&&!c.once||r&&c.context!==r||s(this,i);else{for(var f=0,u=[],a=c.length;f<a;f++)(c[f].fn!==n||o&&!c[f].once||r&&c[f].context!==r)&&u.push(c[f]);u.length?this._events[i]=1===u.length?u[0]:u:s(this,i)}return this},i.prototype.removeAllListeners=function(e){var r;return e?(r=t?t+e:e,this._events[r]&&s(this,r)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=t,i.EventEmitter=i,"undefined"!=typeof module&&(module.exports=i);
},{}],"JVd7":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Assignment=void 0;var n=e(require("eventemitter3")),i=require("./"),r=function(e){function n(t,n){var r,o,s,u,a,m,l=e.call(this)||this;l._name="",l._volume=1,l._meter=0,l._muted=!1,l._assigned=!1,l._running=!1,l._throttle=50;var h=(null!==(r=null==n?void 0:n.name)&&void 0!==r?r:"").trim();if(!t||!h)throw new Error("Must provide an ID and name to create an assignment.");return l.id=t,l.name=h,l.volume=null!==(o=n.volume)&&void 0!==o?o:1,l.meter=0,l.muted=Boolean(null!==(s=n.muted)&&void 0!==s&&s),l.assigned=Boolean(null!==(u=n.assigned)&&void 0!==u&&u),l.running=Boolean(null!==(a=n.running)&&void 0!==a&&a),l.throttle=null!==(m=n.throttle)&&void 0!==m?m:50,$MM.onVolume(l.id,function(t){l.emit("volumeChanged",t)}),$MM.onPress(l.id,i.Button.Mute,function(){l.emit("mutePressed")}),$MM.onPress(l.id,i.Button.Assign,function(){l.emit("assignPressed")}),$MM.onPress(l.id,i.Button.Run,function(){l.emit("runPressed")}),l}return t(n,e),n.prototype.remove=function(){$MM.removeAssignment(this.id)},Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(t){var e=t.trim();if(!e)throw new Error("Can't set an assignment name to be blank.");this._name!==e&&(this._name=e,$MM.updateAssignment(this.id,{name:this._name}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(t){var e=Math.min(1,Math.max(0,t));this._volume!==e&&(this._volume=e,$MM.setIndicator(this.id,i.Indicator.Volume,this._volume))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"meter",{get:function(){return this._meter},set:function(t){var e=this;this._meterTimer&&(clearTimeout(this._meterTimer),delete this._meterTimer);var n=Math.min(1,Math.max(0,t));this._meter=n,$MM.setIndicator(this.id,i.Indicator.Meter,this._meter),this._meterTimer=setTimeout(function(){e._meter=0},150)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._muted},set:function(t){var e=Boolean(t);this._muted!==e&&(this._muted=e,$MM.setButtonIndicator(this.id,i.Button.Mute,this._muted))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"assigned",{get:function(){return this._assigned},set:function(t){var e=Boolean(t);this._assigned!==e&&(this._assigned=Boolean(t),$MM.setButtonIndicator(this.id,i.Button.Assign,this._assigned))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"running",{get:function(){return this._running},set:function(t){var e=Boolean(t);this._running!==e&&(this._running=Boolean(t),$MM.setButtonIndicator(this.id,i.Button.Run,this._running))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"throttle",{get:function(){return this._throttle},set:function(t){var e=Math.min(1e3,Math.max(50,t));this._throttle!==e&&(this._throttle=e,$MM.setThrottle(this.id,this._throttle))},enumerable:!1,configurable:!0}),n}(n.default);exports.Assignment=r;
},{"eventemitter3":"JJlS","./":"pOiF"}],"fk5p":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ButtonType=void 0;var n=e(require("eventemitter3")),r=require("."),o=function(e){function n(t,n){var o,i=e.call(this)||this;i._name="",i._active=!1;var a=(null!==(o=null==n?void 0:n.name)&&void 0!==o?o:"").trim();if(!t||!a)throw new Error("Must provide an ID and a name to create a button type.");return i.id=t,i.name=a,i.active=Boolean(n.active),$MM.onPress(i.id,r.Button.Generic,function(){i.emit("pressed")}),i}return t(n,e),n.prototype.remove=function(){$MM.removeAssignment(this.id)},Object.defineProperty(n.prototype,"name",{get:function(){return this._name},set:function(t){var e=t.trim();if(!e)throw new Error("Can't set a button type name to be blank.");this._name!==e&&(this._name=e,$MM.updateButtonType(this.id,{name:e}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"active",{get:function(){return this._active},set:function(t){var e=Boolean(t);this._active!==e&&(this._active=e,$MM.setButtonIndicator(this.id,r.Button.Generic,this._active))},enumerable:!1,configurable:!0}),n}(n.default);exports.ButtonType=o;
},{"eventemitter3":"JJlS",".":"pOiF"}],"pOiF":[function(require,module,exports) {
"use strict";var e,t,r=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Button=exports.Indicator=void 0,n(require("./Assignment"),exports),n(require("./ButtonType"),exports),function(e){e.Volume="volume",e.Meter="meter"}(e=exports.Indicator||(exports.Indicator={})),function(e){e.Mute="mute",e.Assign="assign",e.Run="run",e.Generic="generic"}(t=exports.Button||(exports.Button={}));
},{"./Assignment":"JVd7","./ButtonType":"fk5p"}],"in7L":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HueSyncApi=void 0;var n,t=require("midi-mixer-plugin"),e=function(n,t,e,s){return new(e||(e=Promise))(function(i,o){function r(n){try{c(s.next(n))}catch(t){o(t)}}function u(n){try{c(s.throw(n))}catch(t){o(t)}}function c(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e(function(n){n(t)})).then(r,u)}c((s=s.apply(n,t||[])).next())})},s=function(n,t){var e,s,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;r;)try{if(e=1,s&&(i=2&o[0]?s.return:o[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,o[1])).done)return i;switch(s=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(n,r)}catch(u){o=[6,u],s=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};!function(n){n.Brightness="brightness",n.Hue="hue"}(n||(n={}));var i=function(){function i(){var n=this;this.assignments={groups:{},lights:{}},this.syncingLights=null,this.syncingGroups=null,this.needResync=!1,this.changeSyncTimer=null,this.settings=$MM.getSettings(),this.baseUrl=new Promise(function(t,e){n.settings.then(function(n){return(null==n?void 0:n.hueip)?(null==n?void 0:n.hueuser)?void t("http://"+n.hueip+"/api/"+n.hueuser):e(new Error("No Philips Hue user given to log in as.")):e(new Error("No Philips Hue IP given to connect to."))}).catch(e)}),this.syncGroups(),this.syncLights(),this.settings.then(function(t){var e=Math.ceil(Number(t.synctime||30)),s=isFinite(e)&&e?1e3*e:3e4;console.log("Sync interval:",s/1e3,"seconds"),setInterval(function(){return n.syncGroups()},s),setInterval(function(){return n.syncLights()},s)})}return i.prototype.throttleSync=function(){var n=this;this.needResync=!0,this.changeSyncTimer||(this.changeSyncTimer=setInterval(function(){return e(n,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.needResync=!1,[4,Promise.all([this.syncGroups(),this.syncLights()])];case 1:return n.sent(),!this.needResync&&this.changeSyncTimer&&(clearInterval(this.changeSyncTimer),this.changeSyncTimer=null),[2]}})})},200))},i.prototype.syncLights=function(){var n;return e(this,void 0,Promise,function(){var t=this;return s(this,function(e){return null!==(n=this.syncingLights)&&void 0!==n||(this.syncingLights=this._syncLights().then(function(){t.syncingLights=null})),[2,this.syncingLights]})})},i.prototype.syncGroups=function(){var n,t=this;return null!==(n=this.syncingGroups)&&void 0!==n||(this.syncingGroups=this._syncGroups().then(function(){t.syncingGroups=null})),this.syncingGroups},i.prototype._syncLights=function(){return e(this,void 0,Promise,function(){var e,i,o=this;return s(this,function(s){switch(s.label){case 0:return console.log("Syncing lights"),[4,this.baseUrl];case 1:return e=s.sent(),[4,fetch(e+"/lights").then(function(n){return n.json()})];case 2:return i=s.sent(),Object.entries(i).forEach(function(s){var i=s[0],r=s[1];if(o.assignments.lights[i]){o.assignments.lights[i].brightness=r.state.bri,o.assignments.lights[i].hue=r.state.hue;var u=o.assignments.lights[i].assignment;u.name=r.name+" (light)",u.muted=r.state.on,u.running=o.assignments.lights[i].controlling===n.Hue,u.volume=o.assignments.lights[i].controlling===n.Hue?r.state.hue/65535:r.state.bri/254}else{var c=new t.Assignment("light-"+i,{name:r.name+" (light)",assigned:!1,muted:r.state.on,volume:r.state.bri/254,throttle:100});c.on("volumeChanged",function(t){c.volume=t;var s={transitiontime:1};o.assignments.lights[i].controlling===n.Hue?(s.hue=Math.round(65535*c.volume),s.sat=254):s.bri=Math.round(254*c.volume),fetch(e+"/lights/"+i+"/state",{method:"PUT",body:JSON.stringify(s)}).then(function(n){n.ok&&o.throttleSync()})}),c.on("runPressed",function(){var t,e;o.assignments.lights[i]&&(o.assignments.lights[i].controlling===n.Brightness?(c.running=!0,o.assignments.lights[i].controlling=n.Hue,c.volume=(null!==(t=o.assignments.lights[i].hue)&&void 0!==t?t:0)/65535):(c.running=!1,o.assignments.lights[i].controlling=n.Brightness,c.volume=(null!==(e=o.assignments.lights[i].brightness)&&void 0!==e?e:0)/254))}),c.on("mutePressed",function(){var n;c.muted=!c.muted,fetch(e+"/lights/"+i+"/state",{method:"PUT",body:JSON.stringify({bri:Math.round(null!==(n=o.assignments.lights[i].brightness)&&void 0!==n?n:254),on:c.muted,transitiontime:1})}).then(function(n){n.ok&&o.throttleSync()})}),o.assignments.lights[i]={assignment:c,controlling:n.Brightness,brightness:r.state.bri,hue:r.state.hue}}}),[2]}})})},i.prototype._syncGroups=function(){return e(this,void 0,Promise,function(){var e,i,o,r,u=this;return s(this,function(s){switch(s.label){case 0:return console.log("Syncing groups"),[4,this.baseUrl];case 1:return e=s.sent(),[4,Promise.all([fetch(e+"/groups").then(function(n){return n.json()}),fetch(e+"/scenes").then(function(n){return n.json()})])];case 2:return i=s.sent(),o=i[0],r=i[1],Object.entries(o).forEach(function(s){var i,o,r=s[0],c=s[1];if(u.assignments.groups[r]){u.assignments.groups[r].brightness=null!==(i=c.action.bri)&&void 0!==i?i:254,u.assignments.groups[r].hue=null!==(o=c.action.hue)&&void 0!==o?o:0;var l=u.assignments.groups[r].assignment;l.name=c.name+" (room)",l.muted=c.action.on,l.volume=u.assignments.groups[r].controlling===n.Hue?c.action.hue/65535:c.action.bri/254,l.running=u.assignments.groups[r].controlling===n.Hue,u.assignments.groups[r].scenes=["colorloop"]}else{var a=new t.Assignment("group-"+r,{name:c.name+" (room)",muted:c.action.on,volume:c.action.bri/254,throttle:1e3,assigned:!0});a.on("volumeChanged",function(t){a.volume=t;var s={transitiontime:10};u.assignments.groups[r].controlling===n.Hue?(s.hue=Math.round(65535*a.volume),s.sat=254):s.bri=Math.round(254*a.volume),fetch(e+"/groups/"+r+"/action",{method:"PUT",body:JSON.stringify(s)}).then(function(n){n.ok&&u.throttleSync()})}),a.on("runPressed",function(){var t,e;u.assignments.groups[r]&&(u.assignments.groups[r].controlling===n.Brightness?(a.running=!0,u.assignments.groups[r].controlling=n.Hue,a.volume=(null!==(t=u.assignments.groups[r].hue)&&void 0!==t?t:0)/65535):(a.running=!1,u.assignments.groups[r].controlling=n.Brightness,a.volume=(null!==(e=u.assignments.groups[r].brightness)&&void 0!==e?e:0)/254))}),a.on("mutePressed",function(){var n;a.muted=!a.muted,fetch(e+"/groups/"+r+"/action",{method:"PUT",body:JSON.stringify({bri:Math.round(null!==(n=u.assignments.groups[r].brightness)&&void 0!==n?n:254),on:a.muted,transitiontime:1})}).then(function(n){n.ok&&u.throttleSync()})}),a.on("assignPressed",function(){var n,t,s,i,o=u.assignments.groups[r];if(o){o.currentScene=((null!==(n=o.currentScene)&&void 0!==n?n:-1)+1)%(null!==(s=null===(t=o.scenes)||void 0===t?void 0:t.length)&&void 0!==s?s:0);var c=null===(i=o.scenes)||void 0===i?void 0:i[o.currentScene];c&&fetch(e+"/groups/"+r+"/action",{method:"PUT",body:JSON.stringify({on:!0,scene:c,transitiontime:1,effect:"colorloop"===c?"colorloop":"none"})}).then(function(n){n.ok&&u.throttleSync()})}}),u.assignments.groups[r]={assignment:a,scenes:["colorloop"],controlling:n.Brightness}}}),Object.entries(r).forEach(function(n){var t,e=n[0],s=n[1],i=u.assignments.groups[s.group];i&&(null===(t=i.scenes)||void 0===t||t.push(e))}),[2]}})})},i}();exports.HueSyncApi=i;
},{"midi-mixer-plugin":"pOiF"}],"QCba":[function(require,module,exports) {
"use strict";var e=require("./api");new e.HueSyncApi;
},{"./api":"in7L"}]},{},["QCba"], null)
//# sourceMappingURL=src.8d44fbea.js.map